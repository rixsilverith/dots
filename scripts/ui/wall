#!/usr/bin/bash

source "$DOTS_HOME/scripts/core/dot.sh"

##? Sets the desktop wall
##?
##? Usage: dot ui wall [name]
##?
##?    If [name] is not provided, a list with the available walls will be
##?    displayed for one to be selected.
##?
docs::parse "$@"
script::depends_on feh fd dmenu

walls_dir="$DOTS_HOME/misc/walls"

wall::set() {
  cp "$walls_dir/${1}.jpg" "$walls_dir/.wall.jpg"
  feh --bg-scale --no-fehbg "$walls_dir/.wall.jpg"
  notify-send -i "$DOTS_HOME/wm/dunst/icons/background.svg" "Background changed" "Background changed to <b>${1}</b>!"
}

wall::list() {
  local -r walls=($(fd . "$walls_dir" --extension jpg))
  declare -a wall_list

  for wall in ${walls[@]}; do
    name=${wall%.jpg}
    name=${name##*/}
    wall_list+=("${name^}")
  done

  selected=$(printf '%s\n' "${wall_list[@]}" | dmenu -p "Choose a wall to set ")
  wall::set "${selected,,}" && exit 0
}

[[ $# -eq 0 ]] && wall::list || wall::set "$1"

